{% extends "Echo_app/base.html" %}
{% load static %}

{% block title %}Minhas Curtidas{% endblock %}

{% block extra_css %}
<!-- 
    Reutilizando o CSS do dashboard para garantir a fidelidade visual dos filtros.
    Se você tiver estilos específicos em 'lista_noticias_jornal.css', mantenha-o também.
-->
<link rel="stylesheet" href="{% static 'Echo_app/css/dashboard.css' %}?v={% now 'U' %}">
<link rel="stylesheet" href="{% static 'Echo_app/css/lista_noticias_jornal.css' %}?v={% now 'U' %}">

<style>
    /* Ajustes específicos para a página de curtidas */
    .curtidas-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .main-title {
        font-size: 2rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 10px;
        border-left: 5px solid #cc0000;
        padding-left: 15px;
    }

    .filter-section {
        margin-bottom: 30px;
    }

    /* Estilo da Barra de Pesquisa (Integrado ao visual clean) */
    .search-form {
        display: flex;
        margin-bottom: 20px;
        max-width: 600px;
    }
    
    .search-input {
        flex-grow: 1;
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-right: none;
        border-radius: 4px 0 0 4px;
        font-size: 1rem;
        outline: none;
    }
    
    .search-button {
        background-color: #cc0000;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 0 4px 4px 0;
        cursor: pointer;
        font-weight: bold;
    }

    /* REPLICAÇÃO EXATA DO ESTILO DO DASHBOARD PARA OS FILTROS */
    .category-bubbles-container {
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 10px;
        -webkit-overflow-scrolling: touch;
        margin-bottom: 20px;
    }

    .category-bubbles {
        display: inline-flex;
        gap: 10px;
    }

    .bubble {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        background-color: #f0f0f0;
        color: #333;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.2s ease;
        border: 1px solid transparent;
    }

    .bubble:hover {
        background-color: #e0e0e0;
    }

    .bubble.active {
        background-color: #cc0000;
        color: white;
        font-weight: 600;
        box-shadow: 0 2px 5px rgba(204, 0, 0, 0.3);
    }

    /* Grid de Notícias */
    .noticias-listagem {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }
</style>
{% endblock %}

{% block content %}

<div class="curtidas-container">

    <h1 class="main-title">Minhas Curtidas</h1>
    
    <div class="filter-section">
        
        <!-- Barra de Pesquisa -->
        <form method="GET" class="search-form" action="{% url 'Echo_app:noticias_curtidas' %}">
            <input type="text" name="q" placeholder="Pesquisar nas curtidas..." class="search-input" value="{{ request.GET.q|default:'' }}">
            
            <!-- Mantém a categoria selecionada durante a pesquisa -->
            {% if categoria_ativa %}
                <input type="hidden" name="categoria" value="{{ categoria_ativa }}">
            {% endif %}

            <button type="submit" class="search-button">
                Pesquisar
            </button>
        </form>
        
        <!-- 
            FILTROS DE CATEGORIA (ESTILO DASHBOARD)
            Aqui usamos a mesma estrutura de classes que você mostrou no dashboard.html
        -->
        <div class="category-bubbles-container">
            <div class="category-bubbles">
                
                {% url 'Echo_app:noticias_curtidas' as curtidas_url %}
                {% with q_param=request.GET.q|default:'' %}
                
                <!-- Botão TUDO -->
                <a href="{{ curtidas_url }}?q={{ q_param }}" 
                   class="bubble {% if not categoria_ativa %}active{% endif %}">
                    Tudo
                </a>
                
                <!-- Botões de Categorias -->
                {% for categoria in categorias_disponiveis %}
                    <a href="{{ curtidas_url }}?categoria={{ categoria.nome }}&q={{ q_param }}" 
                       class="bubble {% if categoria_ativa == categoria.nome %}active{% endif %}">
                        {{ categoria.nome }}
                    </a>
                {% endfor %}
                
                {% endwith %}

            </div>
        </div>

    </div>

    <!-- Informação de Resultados -->
    <div class="curtidas-header">
        <p class="curtidas-info">
            {% if categoria_ativa %}
                Exibindo curtidas em: <strong>{{ categoria_ativa }}</strong>
            {% endif %}
            {% if request.GET.q %}
                 - Buscando por: "<strong>{{ request.GET.q }}</strong>"
            {% endif %}
            (Total: {{ total_curtidas }})
        </p>
    </div>

    <!-- Lista de Notícias -->
    {% if noticias_curtidas %}
        <div class="noticias-listagem">
            {% for noticia in noticias_curtidas %}
            <article class="noticia-item">
                <a href="{% url 'Echo_app:noticia_detalhe' pk=noticia.pk %}" class="noticia-link">
                    
                    <div class="noticia-imagem-box">
                        {% if noticia.imagem %}
                            <img src="{{ noticia.imagem.url }}" alt="{{ noticia.titulo }}" class="noticia-imagem">
                        {% else %}
                            <div class="imagem-placeholder"><span>Sem Imagem</span></div>
                        {% endif %}
                    </div>
                    
                    <div class="noticia-body">
                        <span class="noticia-tag tag-{{ noticia.categoria.nome|slugify|default:'geral' }}">
                            {{ noticia.categoria.nome|default:"Geral" }}
                        </span>
                        
                        <h2 class="noticia-titulo">{{ noticia.titulo }}</h2>
                        
                        <p class="noticia-resumo">
                            {{ noticia.conteudo|safe|striptags|truncatechars:100 }}
                        </p>
                        
                        <div class="noticia-meta">
                            <span class="meta-data">
                                {{ noticia.data_publicacao|date:"d/m/Y" }}
                            </span>
                            <span class="meta-curtida">
                                <i class="fas fa-heart"></i>
                            </span>
                        </div>
                    </div>
                    
                </a>
            </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h3>Nenhuma notícia encontrada com esses filtros.</h3>
            <a href="{% url 'Echo_app:noticias_curtidas' %}" class="empty-btn-link">Limpar Filtros</a>
        </div>
    {% endif %}
</div>

{% endblock %}